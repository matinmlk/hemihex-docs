"use strict";(globalThis.webpackChunkhemihex_docs=globalThis.webpackChunkhemihex_docs||[]).push([[3557],{28453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>l});var t=i(96540);const o={},a=t.createContext(o);function s(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),t.createElement(a.Provider,{value:n},e.children)}},83654:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>r,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"HH-101/Online AI Model/multimodal-visual-understanding-application-12-onlineaimodel-12-2","title":"Multimodal Video Understanding","description":"1. Concept Introduction","source":"@site/docs/hh101/HH-101/12 - Online AI Model/02-multimodal-visual-understanding-application-12-onlineaimodel-12-2.md","sourceDirName":"HH-101/12 - Online AI Model","slug":"/HH-101/Online AI Model/multimodal-visual-understanding-application-12-onlineaimodel-12-2","permalink":"/hh-101/HH-101/Online AI Model/multimodal-visual-understanding-application-12-onlineaimodel-12-2","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":0,"frontMatter":{"title":"Multimodal Video Understanding","sidebar_position":0},"sidebar":"hh101Sidebar","previous":{"title":"Multimodal Autonomous Proxy Application","permalink":"/hh-101/HH-101/Offline AI Model/ai-large-model-offline-voice-assistant-11-offlineaimodel-11-26"},"next":{"title":"OpenRouter Large Model API Aggregation Platform","permalink":"/hh-101/HH-101/Online AI Model/openrouter-api-aggregation-platform-12-onlineaimodel-12-1"}}');var o=i(74848),a=i(28453);const s={title:"Multimodal Video Understanding",sidebar_position:0},l="2.Multimodal visual understand application",r={},d=[{value:"1. Concept Introduction",id:"1-concept-introduction",level:2},{value:"1.1 What is &quot;Video Analysis&quot;?",id:"11-what-is-video-analysis",level:3},{value:"1.2 Implementation Principles",id:"12-implementation-principles",level:3},{value:"2. Code Analysis",id:"2-code-analysis",level:2},{value:"Key Code",id:"key-code",level:3},{value:"1. Tool Layer Entry ( largemodel/utils/tools_manager.py )",id:"1-tool-layer-entry--largemodelutilstools_managerpy-",level:4},{value:"2. Model interface layer and frame extraction ( largemodel/utils/large_model_interface.py )",id:"2-model-interface-layer-and-frame-extraction--largemodelutilslarge_model_interfacepy-",level:4},{value:"Code Analysis",id:"code-analysis",level:3},{value:"3. Practical Operations",id:"3-practical-operations",level:2},{value:"3.1 Configuring Online LLM",id:"31-configuring-online-llm",level:3},{value:"3.2 Launching and Testing the Functionality",id:"32-launching-and-testing-the-functionality",level:3}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"2multimodal-visual-understand-application",children:"2.Multimodal visual understand application"})}),"\n",(0,o.jsx)(n.h2,{id:"1-concept-introduction",children:"1. Concept Introduction"}),"\n",(0,o.jsx)(n.h3,{id:"11-what-is-video-analysis",children:'1.1 What is "Video Analysis"?'}),"\n",(0,o.jsxs)(n.p,{children:["In the",(0,o.jsx)(n.code,{children:"largemodel"}),"project, the",(0,o.jsx)(n.strong,{children:"multimodal video analysis"}),"feature enables a robot to process a video and summarize its core content, describe key events, or answer specific questions about the video in natural language. This allows the robot to leap from understanding only static images to understanding dynamic and temporal relationships."]}),"\n",(0,o.jsxs)(n.p,{children:["The core tool for this feature is",(0,o.jsx)(n.code,{children:"analyze_video"}),'. When a user provides a video file and asks a question (such as "Summarize what this video says"), the system invokes this tool to process and analyze the video and return a textual response from the AI.']}),"\n",(0,o.jsx)(n.h3,{id:"12-implementation-principles",children:"1.2 Implementation Principles"}),"\n",(0,o.jsx)(n.p,{children:"The core challenge of offline video analysis lies in how to efficiently process video data containing hundreds or thousands of frames. A popular implementation principle is as follows:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Keyframe Extraction"}),"\n: First, the system does not process every frame of the video. Instead, it extracts the most representative keyframes through algorithms (such as scene boundary detection or fixed-time sampling). This significantly reduces the amount of data required for processing."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Image Encoding"}),"\n: Each extracted keyframe is fed into a visual encoder, similar to visual understanding applications, and converted into a digital vector containing image information."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Temporal Information Fusion"}),'\n: This is the most significant difference from single-image understanding. The model needs to understand the temporal order between these keyframes. Typically, a recurrent neural network (RNN) or Transformer model is used to fuse the vectors of all keyframes to form a "memory" vector that represents the dynamic content of the entire video.']}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Question-Answering and Generation"}),'\n: The user\'s text question is encoded and then cross-modally fused with this "memory" vector. Finally, the language model generates a summary of the entire video or an answer to a specific question based on this fused information.']}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Simply put, it is to",(0,o.jsx)(n.strong,{children:"condense a video into several key pictures and their sequence, and then understand the whole story like reading a comic strip and answer related questions"}),"."]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"2-code-analysis",children:"2. Code Analysis"}),"\n",(0,o.jsx)(n.h3,{id:"key-code",children:"Key Code"}),"\n",(0,o.jsx)(n.h4,{id:"1-tool-layer-entry--largemodelutilstools_managerpy-",children:"1. Tool Layer Entry ( largemodel/utils/tools_manager.py )"}),"\n",(0,o.jsxs)(n.p,{children:["The",(0,o.jsx)(n.code,{children:"analyze_video"}),"function in this file defines the execution flow of the tool."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'# From largemodel/utils/tools_manager.py\nclass ToolsManager:\n    # ...\n    def analyze_video(self, args):\n        """\n        Analyze video file and provide content description.\n        Analyzes video files and provides a description of the content.\n\n        :param args: Arguments containing video path.\n        :return: Dictionary with video description and path.\n        """\n        self.node.get_logger().info(f"Executing analyze_video() tool with args: {args}")\n        try:\n            video_path = args.get("video_path")\n            # ... (Intelligent path fallback mechanism)\n\n            if video_path and os.path.exists(video_path):\n                # ... (Build Prompt)\n\n                # Use a fully isolated, one-time context for video analysis to ensure a plain text description.\n                simple_context = [{\n                    "role": "system",\n                    "content": "You are a video description assistant. ..."\n                }]\n\n                result = self.node.model_client.infer_with_video(video_path, prompt, message=simple_context)\n\n                # ... (processing results)\n                return {\n                    "description": description,\n                    "video_path": video_path\n                }\n            # ... (error handling)\n'})}),"\n",(0,o.jsx)(n.h4,{id:"2-model-interface-layer-and-frame-extraction--largemodelutilslarge_model_interfacepy-",children:"2. Model interface layer and frame extraction ( largemodel/utils/large_model_interface.py )"}),"\n",(0,o.jsx)(n.p,{children:"The functions in this file are responsible for processing the video files and passing them to the underlying model."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'# From largemodel/utils/large_model_interface.py\n\nclass model_interface:\n    # ...\n    def infer_with_video(self, video_path, text=None, message=None):\n        """Unified video inference interface. """\n        # ... (prepare message)\n        try:\n           # Determine which specific implementation to call based on self.llm_platform\n            if self.llm_platform == \'ollama\':\n                response_content = self.ollama_infer(self.messages, video_path=video_path)\n            # ... (Logic for other online platforms)\n        # ...\n        return {\'response\': response_content, \'messages\': self.messages.copy()}\n\n    def _extract_video_frames(self, video_path, max_frames=5):\n        """Extract keyframes from a video for analysis. """\n        try:\n            import cv2\n            # ... (video reading and frame interval calculation)\n            while extracted_count < max_frames:\n                # ... (Loop reading video frames)\n                if frame_count % frame_interval == 0:\n                    # ... (save the frame as a temporary image)\n                    frame_base64 = self.encode_file_to_base64(temp_path)\n                    frame_images.append(frame_base64)\n            # ...\n            return frame_images\n        # ... (Exception handling)\n'})}),"\n",(0,o.jsx)(n.h3,{id:"code-analysis",children:"Code Analysis"}),"\n",(0,o.jsx)(n.p,{children:"The implementation of video analysis is more complex than image analysis. It requires a key preprocessing step at the model interface layer: frame extraction."}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Tools Layer (tools_manager.py)"}),":"]}),"\n"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["The\n",(0,o.jsx)(n.code,{children:"analyze_video"}),"\nfunction is the entry point for video analysis. Its responsibilities are clear: accept a video file path and construct a prompt to request a description of the video content."]}),"\n",(0,o.jsxs)(n.li,{children:["It initiates the analysis process by calling the\n",(0,o.jsx)(n.code,{children:"self.node.model_client.infer_with_video"}),'\nmethod. Like the visual understanding tool, it is completely agnostic about the underlying model details and only handles passing the "video file" and "analysis instructions."']}),"\n"]}),"\n",(0,o.jsxs)(n.ol,{start:"2",children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Model Interface Layer (large_model_interface.py)"}),":"]}),"\n"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["The\n",(0,o.jsx)(n.code,{children:"infer_with_video"}),"\nfunction is the scheduler that connects the upper-level tools with the underlying model. It dispatches tasks to the corresponding implementation functions based on the platform configuration (\n",(0,o.jsx)(n.code,{children:"self.llm_platform"}),"\n)."]}),"\n",(0,o.jsxs)(n.li,{children:["Unlike processing single images, processing videos requires an additional step. The\n",(0,o.jsx)(n.code,{children:"_extract_video_frames"}),"\nmethod demonstrates the general logic for implementing this step: it uses the\n",(0,o.jsx)(n.code,{children:"cv2"}),"\nlibrary to read the video and extract several keyframes (by default, five)."]}),"\n",(0,o.jsx)(n.li,{children:"Each extracted frame is treated as a separate image and typically encoded as a Base64 string."}),"\n",(0,o.jsx)(n.li,{children:"Ultimately, a request containing multiple frame image data and analysis instructions is sent to the main model. The model performs a comprehensive analysis of these consecutive images to generate a description of the entire video content."}),"\n",(0,o.jsx)(n.li,{children:'This "video-to-multiple-images" preprocessing is completely encapsulated in the model interface layer and is transparent to the tool layer.'}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["In summary, the general process of video analysis is:",(0,o.jsx)(n.code,{children:"ToolsManager"}),"initiates an analysis request ->",(0,o.jsx)(n.code,{children:"model_interface"}),"intercepts the request and calls",(0,o.jsx)(n.code,{children:"_extract_video_frames"}),"to decompose the video file into multiple keyframe images ->",(0,o.jsx)(n.code,{children:"model_interface"}),"sends these images, along with analysis instructions, to the corresponding model platform according to the configuration -> the model returns a comprehensive description of the video -> the results are finally returned to",(0,o.jsx)(n.code,{children:"ToolsManager"}),". This design ensures the stability and versatility of upper-layer applications."]}),"\n",(0,o.jsx)(n.h2,{id:"3-practical-operations",children:"3. Practical Operations"}),"\n",(0,o.jsx)(n.h3,{id:"31-configuring-online-llm",children:"3.1 Configuring Online LLM"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.strong,{children:"First, obtain an API key from any platform described in the previous tutorial"})}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Then, you need to update the key in the configuration file and open the model interface configuration file.large_model_interface.yaml"}),":\nxxxxxxxxxxvim~/yahboom_ws/src/largemodel/config/large_model_interface.yaml"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Enter your API Key"}),":Find",' the corresponding section and paste the API Key you just copied. This example uses the Tongyi Qianwen configuration.\nx# large_model_interface.yaml## Thousand Questions on Tongyiqianwen_api_key:"sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"# Paste your Keyqianwen_model:"qwen-vl-max-latest"# You can choose the model as needed, such as qwen-turbo, qwen-plus']}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Open the main configuration file yahboom.yaml"}),":\nxxxxxxxxxxvim~/yahboom_ws/src/largemodel/config/yahboom.yaml"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Select the online platform you want to use"}),":Change"," the",(0,o.jsx)(n.code,{children:"llm_platform"}),"parameter to the platform name you want to use.\nxxxxxxxxxx# yahboom.yamlmodel_service:ros__parameters:# ...llm_platform:'tongyi'#Optional platforms: 'ollama', 'tongyi', 'spark', 'qianfan', 'openrouter'"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"32-launching-and-testing-the-functionality",children:"3.2 Launching and Testing the Functionality"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Launch the largemodel main program and enable text interaction mode"}),":\nxxxxxxxxxxros2 launch largemodel largemodel_control.launch.py text_chat_mode:=true"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Send text command"}),":Open"," another terminal and run the following command:\nxxxxxxxxxxros2 run text_chat text_chat"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Then, start typing your question."}),"\n",(0,o.jsxs)(n.ol,{start:"3",children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Test"}),":"]}),"\n"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Type your question in the terminal and press Enter. For example:\n",(0,o.jsx)(n.code,{children:"Analyze this video"})]}),"\n",(0,o.jsx)(n.li,{children:"Watch the terminal output. After a few moments, you should see a detailed answer returned from the cloud-based model."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}}}]);