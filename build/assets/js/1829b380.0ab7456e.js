"use strict";(globalThis.webpackChunkhemihex_docs=globalThis.webpackChunkhemihex_docs||[]).push([[2826],{4744:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/listener_cpp-559c008d9a90855b14c78b33ff2f2889.jpg"},23080:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/brocast_cpp-ec42668ec6bdc08c5b2a1079c7d4ffca.jpg"},28453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>o});var t=r(96540);const i={},s=t.createContext(i);function a(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(s.Provider,{value:n},e.children)}},72400:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"ROS1/tf-publishing-and-monitoring","title":"TF Publishing and Monitoring","description":"10.1 TF Function Package","source":"@site/docs/09 - ROS1/10-tf-publishing-and-monitoring.md","sourceDirName":"09 - ROS1","slug":"/ROS1/tf-publishing-and-monitoring","permalink":"/docs/ROS1/tf-publishing-and-monitoring","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/09 - ROS1/10-tf-publishing-and-monitoring.md","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"sidebar_position":10,"title":"TF Publishing and Monitoring"},"sidebar":"tutorialSidebar","previous":{"title":"Custom Service Messages and Usage","permalink":"/docs/ROS1/custom-service-messages-and-usage"},"next":{"title":"Service Communication","permalink":"/docs/ROS2/ros2-service"}}');var i=r(74848),s=r(28453);const a={sidebar_position:10,title:"TF Publishing and Monitoring"},o="10. TF Publishing and Monitoring",l={},d=[{value:"10.1 TF Function Package",id:"101-tf-function-package",level:2},{value:"10.1.1 Overview",id:"1011-overview",level:3},{value:"10.1.2 Usage Steps",id:"1012-usage-steps",level:3},{value:"10.2 Programming Implementation of Broadcasting and Monitoring",id:"102-programming-implementation-of-broadcasting-and-monitoring",level:2},{value:"10.2.1 Creating and Compiling the Package",id:"1021-creating-and-compiling-the-package",level:3},{value:"10.2.2 TF Broadcaster Implementation Steps",id:"1022-tf-broadcaster-implementation-steps",level:3},{value:"10.2.3 TF Listener Implementation Steps",id:"1023-tf-listener-implementation-steps",level:3},{value:"10.2.4 C++ Implementation of TF Broadcaster",id:"1024-c-implementation-of-tf-broadcaster",level:3},{value:"Step 1: Create File",id:"step-1-create-file",level:4},{value:"Step 2: Add the Following Code",id:"step-2-add-the-following-code",level:4},{value:"TF Broadcaster Process Flow",id:"tf-broadcaster-process-flow",level:3},{value:"TF Broadcaster Code Explanation",id:"tf-broadcaster-code-explanation",level:3},{value:"10.2.4 C++ Implementation of TF Listener",id:"1024-c-implementation-of-tf-listener",level:3},{value:"Step 1: Create File",id:"step-1-create-file-1",level:4},{value:"Step 2: Add the Following Code",id:"step-2-add-the-following-code-1",level:4},{value:"TF Listener Process Flow",id:"tf-listener-process-flow",level:3},{value:"TF Listener Code Explanation",id:"tf-listener-code-explanation",level:3},{value:"10.2.5 Modifying <code>CMakeLists.txt</code> and Compiling",id:"1025-modifying-cmakeliststxt-and-compiling",level:3}];function c(e){const n={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"10-tf-publishing-and-monitoring",children:"10. TF Publishing and Monitoring"})}),"\n",(0,i.jsx)(n.h2,{id:"101-tf-function-package",children:"10.1 TF Function Package"}),"\n",(0,i.jsx)(n.h3,{id:"1011-overview",children:"10.1.1 Overview"}),"\n",(0,i.jsx)(n.p,{children:"TF is a functional ROS package that allows users to track multiple\r\ncoordinate systems over time. It uses a tree-shaped data structure to\r\nbuffer and maintain coordinate transformation relationships between\r\nmultiple coordinate systems based on time."}),"\n",(0,i.jsx)(n.p,{children:"It helps developers perform coordinate transformations such as\r\nconverting points and vectors between coordinate systems at any time."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"1012-usage-steps",children:"10.1.2 Usage Steps"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Monitoring TF Transformations"}),(0,i.jsx)(n.br,{}),"\n","Receive and cache all coordinate system transformation data\r\npublished in the system, and query the required coordinate\r\ntransformation relationships."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Broadcasting TF Transformations"}),(0,i.jsx)(n.br,{}),"\n","Broadcast the coordinate transformation relationship between\r\ncoordinate systems. Multiple TF broadcasters may exist in a system\r\nand each can directly insert transformations into the TF tree."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"102-programming-implementation-of-broadcasting-and-monitoring",children:"10.2 Programming Implementation of Broadcasting and Monitoring"}),"\n",(0,i.jsx)(n.h3,{id:"1021-creating-and-compiling-the-package",children:"10.2.1 Creating and Compiling the Package"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ~/catkin_ws/src\r\ncatkin_create_pkg learning_tf rospy roscpp turtlesim tf\r\ncd ..\r\ncatkin_make\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"1022-tf-broadcaster-implementation-steps",children:"10.2.2 TF Broadcaster Implementation Steps"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Define the TF broadcaster (",(0,i.jsx)(n.code,{children:"TransformBroadcaster"}),")"]}),"\n",(0,i.jsx)(n.li,{children:"Initialize TF data and create coordinate transformations"}),"\n",(0,i.jsxs)(n.li,{children:["Publish coordinate transformation (",(0,i.jsx)(n.code,{children:"sendTransform"}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"1023-tf-listener-implementation-steps",children:"10.2.3 TF Listener Implementation Steps"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Define the TF listener (",(0,i.jsx)(n.code,{children:"TransformListener"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["Find coordinate transformations (",(0,i.jsx)(n.code,{children:"waitForTransform"}),",\r\n",(0,i.jsx)(n.code,{children:"lookupTransform"}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"1024-c-implementation-of-tf-broadcaster",children:"10.2.4 C++ Implementation of TF Broadcaster"}),"\n",(0,i.jsx)(n.h4,{id:"step-1-create-file",children:"Step 1: Create File"}),"\n",(0,i.jsx)(n.p,{children:"Create the following file:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"learning_tf/src/turtle_tf_broadcaster.cpp\n"})}),"\n",(0,i.jsx)(n.h4,{id:"step-2-add-the-following-code",children:"Step 2: Add the Following Code"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:'#include <ros/ros.h>\r\n#include <tf/transform_broadcaster.h>\r\n#include <turtlesim/Pose.h>\r\n\r\nstd::string turtle_name;\r\n\r\nvoid poseCallback(const turtlesim::PoseConstPtr& msg)\r\n{\r\n    static tf::TransformBroadcaster br;\r\n\r\n    tf::Transform transform;\r\n    transform.setOrigin(tf::Vector3(msg->x, msg->y, 0.0));\r\n\r\n    tf::Quaternion q;\r\n    q.setRPY(0, 0, msg->theta);\r\n    transform.setRotation(q);\r\n\r\n    br.sendTransform(tf::StampedTransform(transform, ros::Time::now(), "world", turtle_name));\r\n}\r\n\r\nint main(int argc, char** argv)\r\n{\r\n    ros::init(argc, argv, "turtle_world_tf_broadcaster");\r\n\r\n    if (argc != 2)\r\n    {\r\n        ROS_ERROR("Missing parameter for turtle name.");\r\n        return -1;\r\n    }\r\n\r\n    turtle_name = argv[1];\r\n\r\n    ros::NodeHandle node;\r\n    ros::Subscriber sub = node.subscribe(turtle_name + "/pose", 10, &poseCallback);\r\n\r\n    ros::spin();\r\n    return 0;\r\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"tf-broadcaster-process-flow",children:"TF Broadcaster Process Flow"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"TF Broadcaster Flow",src:r(23080).A+"",width:"716",height:"1182"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"tf-broadcaster-code-explanation",children:"TF Broadcaster Code Explanation"}),"\n",(0,i.jsxs)(n.p,{children:["The broadcaster subscribes to the turtle ",(0,i.jsx)(n.code,{children:"/pose"})," topic. Whenever new\r\npose data is received, a TF broadcaster is created and a coordinate\r\ntransformation is constructed."]}),"\n",(0,i.jsx)(n.p,{children:"The transformation includes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Translation from ",(0,i.jsx)(n.code,{children:"x"}),", ",(0,i.jsx)(n.code,{children:"y"})]}),"\n",(0,i.jsxs)(n.li,{children:["Rotation from ",(0,i.jsx)(n.code,{children:"theta"})," angle"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The function ",(0,i.jsx)(n.code,{children:"sendTransform()"})," publishes the transformation between the\r\n",(0,i.jsx)(n.code,{children:"world"})," frame and the turtle frame."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"1024-c-implementation-of-tf-listener",children:"10.2.4 C++ Implementation of TF Listener"}),"\n",(0,i.jsx)(n.h4,{id:"step-1-create-file-1",children:"Step 1: Create File"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"learning_tf/src/turtle_tf_listener.cpp\n"})}),"\n",(0,i.jsx)(n.h4,{id:"step-2-add-the-following-code-1",children:"Step 2: Add the Following Code"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:'#include <ros/ros.h>\r\n#include <tf/transform_listener.h>\r\n#include <geometry_msgs/Twist.h>\r\n#include <turtlesim/Spawn.h>\r\n\r\nint main(int argc, char** argv)\r\n{\r\n    ros::init(argc, argv, "turtle1_turtle2_listener");\r\n    ros::NodeHandle node;\r\n\r\n    ros::service::waitForService("/spawn");\r\n    ros::ServiceClient add_turtle = node.serviceClient<turtlesim::Spawn>("/spawn");\r\n    turtlesim::Spawn srv;\r\n    add_turtle.call(srv);\r\n\r\n    ros::Publisher vel = node.advertise<geometry_msgs::Twist>("/turtle2/cmd_vel", 10);\r\n\r\n    tf::TransformListener listener;\r\n    ros::Rate rate(10.0);\r\n\r\n    while (node.ok())\r\n    {\r\n        tf::StampedTransform transform;\r\n        try\r\n        {\r\n            listener.waitForTransform("/turtle2", "/turtle1", ros::Time(0), ros::Duration(3.0));\r\n            listener.lookupTransform("/turtle2", "/turtle1", ros::Time(0), transform);\r\n        }\r\n        catch (tf::TransformException &ex)\r\n        {\r\n            ROS_ERROR("%s", ex.what());\r\n            ros::Duration(1.0).sleep();\r\n            continue;\r\n        }\r\n\r\n        geometry_msgs::Twist turtle2_vel_msg;\r\n\r\n        turtle2_vel_msg.angular.z = 6.0 * atan2(\r\n            transform.getOrigin().y(),\r\n            transform.getOrigin().x());\r\n\r\n        turtle2_vel_msg.linear.x = 0.8 * sqrt(\r\n            pow(transform.getOrigin().x(), 2) +\r\n            pow(transform.getOrigin().y(), 2));\r\n\r\n        vel.publish(turtle2_vel_msg);\r\n        rate.sleep();\r\n    }\r\n\r\n    return 0;\r\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"tf-listener-process-flow",children:"TF Listener Process Flow"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"TF Listener Flow",src:r(4744).A+"",width:"922",height:"1060"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"tf-listener-code-explanation",children:"TF Listener Code Explanation"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Turtle2 is created using the ",(0,i.jsx)(n.code,{children:"/spawn"})," service."]}),"\n",(0,i.jsx)(n.li,{children:"A velocity publisher is created to send movement commands to\r\nTurtle2."}),"\n",(0,i.jsx)(n.li,{children:"A TF listener continuously retrieves coordinate transformations\r\nbetween Turtle1 and Turtle2."}),"\n",(0,i.jsx)(n.li,{children:"Mathematical operations are applied to compute velocity and\r\ndirection."}),"\n",(0,i.jsx)(n.li,{children:"Turtle2 follows Turtle1 dynamically."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h3,{id:"1025-modifying-cmakeliststxt-and-compiling",children:["10.2.5 Modifying ",(0,i.jsx)(n.code,{children:"CMakeLists.txt"})," and Compiling"]}),"\n",(0,i.jsxs)(n.p,{children:["Add the following lines to your package ",(0,i.jsx)(n.code,{children:"CMakeLists.txt"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cmake",children:"add_executable(turtle_tf_broadcaster src/turtle_tf_broadcaster.cpp)\r\ntarget_link_libraries(turtle_tf_broadcaster ${catkin_LIBRARIES})\r\n\r\nadd_executable(turtle_tf_listener src/turtle_tf_listener.cpp)\r\ntarget_link_libraries(turtle_tf_listener ${catkin_LIBRARIES})\n"})}),"\n",(0,i.jsx)(n.p,{children:"Then compile:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ~/catkin_ws\r\ncatkin_make\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:["\u2705 You now have fully working ",(0,i.jsx)(n.strong,{children:"TF broadcaster and listener nodes"})," for\r\nmonitoring coordinate transformations in ROS."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);