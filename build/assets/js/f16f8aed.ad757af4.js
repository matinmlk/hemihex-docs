"use strict";(globalThis.webpackChunkhemihex_docs=globalThis.webpackChunkhemihex_docs||[]).push([[218],{16952:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"ROS1/client","title":"Client","description":"In ROS communication, in addition to topic communication, there is also","source":"@site/docs/09 - ROS1/07-client.md","sourceDirName":"09 - ROS1","slug":"/ROS1/client","permalink":"/docs/ROS1/client","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/09 - ROS1/07-client.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7,"title":"Client"},"sidebar":"tutorialSidebar","previous":{"title":"Customized Topic Messages and Usage","permalink":"/docs/ROS1/customized-topic-messages-and-usage"},"next":{"title":"Server Side","permalink":"/docs/ROS1/server-side"}}');var i=r(74848),s=r(28453);const a={sidebar_position:7,title:"Client"},l="7. Client",c={},o=[{value:"7.1 Preparation Work",id:"71-preparation-work",level:2},{value:"7.1.1 Establishing a Function Package",id:"711-establishing-a-function-package",level:3},{value:"7.2 C++ Language Implementation",id:"72-c-language-implementation",level:2},{value:"7.2.1 Implementation Steps",id:"721-implementation-steps",level:3},{value:"7.2.2 Create the Client Program",id:"722-create-the-client-program",level:3},{value:"Process Flow Diagram",id:"process-flow-diagram",level:3},{value:"CMakeLists.txt Configuration",id:"cmakeliststxt-configuration",level:3},{value:"Compile the Workspace",id:"compile-the-workspace",level:3},{value:"Run the Program",id:"run-the-program",level:3},{value:"Program Output Example",id:"program-output-example",level:3},{value:"Program Description",id:"program-description",level:3},{value:"7.3 Python Language Implementation",id:"73-python-language-implementation",level:2},{value:"7.3.1 Create the Client Script",id:"731-create-the-client-script",level:3},{value:"Python Program Flow Diagram",id:"python-program-flow-diagram",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"7-client",children:"7. Client"})}),"\n",(0,i.jsxs)(n.p,{children:["In ROS communication, in addition to topic communication, there is also\r\na type of ",(0,i.jsx)(n.strong,{children:"service communication"}),". Services include both ",(0,i.jsx)(n.strong,{children:"client"}),"\r\nand ",(0,i.jsx)(n.strong,{children:"server"}),", where the client requests the service and the server\r\nprovides the service. This section explains how to implement a client\r\nusing ",(0,i.jsx)(n.strong,{children:"C++"})," and ",(0,i.jsx)(n.strong,{children:"Python"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"71-preparation-work",children:"7.1 Preparation Work"}),"\n",(0,i.jsx)(n.h3,{id:"711-establishing-a-function-package",children:"7.1.1 Establishing a Function Package"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Switch to the ",(0,i.jsx)(n.code,{children:"~/catkin_ws/src"})," directory:"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"catkin_create_pkg learning_server std_msgs rospy roscpp geometry_msgs turtlesim\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsxs)(n.li,{children:["Switch to the ",(0,i.jsx)(n.code,{children:"~/catkin_ws"})," directory:"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"catkin_make\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"72-c-language-implementation",children:"7.2 C++ Language Implementation"}),"\n",(0,i.jsx)(n.h3,{id:"721-implementation-steps",children:"7.2.1 Implementation Steps"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Initialize the ROS node\\"}),"\n",(0,i.jsx)(n.li,{children:"Create a node handle\\"}),"\n",(0,i.jsx)(n.li,{children:"Create a client instance\\"}),"\n",(0,i.jsx)(n.li,{children:"Initialize and send service request data\\"}),"\n",(0,i.jsx)(n.li,{children:"Wait for the server response"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"722-create-the-client-program",children:"7.2.2 Create the Client Program"}),"\n",(0,i.jsxs)(n.p,{children:["Create a new C++ file under ",(0,i.jsx)(n.code,{children:"server/src"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"a_new_turtle.cpp\n"})}),"\n",(0,i.jsx)(n.p,{children:"Paste the following code:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:'#include <ros/ros.h>\r\n#include <turtlesim/Spawn.h>\r\n\r\nint main(int argc, char** argv)\r\n{\r\n    ros::init(argc, argv, "a_new_turtle");   // Initialize ROS node\r\n    ros::NodeHandle node;\r\n\r\n    ros::service::waitForService("/spawn"); // Wait for spawn service\r\n\r\n    ros::ServiceClient new_turtle =\r\n        node.serviceClient<turtlesim::Spawn>("/spawn");\r\n\r\n    turtlesim::Spawn new_turtle_srv;\r\n    new_turtle_srv.request.x = 6.0;\r\n    new_turtle_srv.request.y = 8.0;\r\n    new_turtle_srv.request.name = "turtle2";\r\n\r\n    ROS_INFO("Call service to create a new turtle named %s at (%.1f, %.1f)",\r\n             new_turtle_srv.request.name.c_str(),\r\n             new_turtle_srv.request.x,\r\n             new_turtle_srv.request.y);\r\n\r\n    new_turtle.call(new_turtle_srv);\r\n\r\n    ROS_INFO("Spawn turtle successfully [name: %s]",\r\n             new_turtle_srv.response.name.c_str());\r\n\r\n    return 0;\r\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"process-flow-diagram",children:"Process Flow Diagram"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Client Flow Chart",src:r(64313).A+"",width:"528",height:"1126"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"cmakeliststxt-configuration",children:"CMakeLists.txt Configuration"}),"\n",(0,i.jsx)(n.p,{children:"Add the following under the build section:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cmake",children:"add_executable(a_new_turtle src/a_new_turtle.cpp)\r\ntarget_link_libraries(a_new_turtle ${catkin_LIBRARIES})\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"compile-the-workspace",children:"Compile the Workspace"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ~/catkin_ws\r\ncatkin_make\r\nsource devel/setup.bash\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"run-the-program",children:"Run the Program"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"roscore\r\nrosrun turtlesim turtlesim_node\r\nrosrun learning_server a_new_turtle\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"program-output-example",children:"Program Output Example"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Client Output",src:r(45837).A+"",width:"1847",height:"658"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"program-description",children:"Program Description"}),"\n",(0,i.jsxs)(n.p,{children:["After starting the turtle simulation node, running the ",(0,i.jsx)(n.code,{children:"a_new_turtle"}),"\r\nprogram will create another turtle on the screen. This is done by\r\ncalling the ",(0,i.jsx)(n.code,{children:"/spawn"})," service provided by the turtle node."]}),"\n",(0,i.jsx)(n.p,{children:"To view all available services:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"rosservice list\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Service List",src:r(86603).A+"",width:"1013",height:"393"})}),"\n",(0,i.jsxs)(n.p,{children:["To inspect the ",(0,i.jsx)(n.code,{children:"/spawn"})," service:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"rosservice info /spawn\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Spawn Service Info",src:r(38405).A+"",width:"1038",height:"131"})}),"\n",(0,i.jsx)(n.p,{children:"The parameters required are:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"x"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"y"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"theta"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"name"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"These are initialized in the client program as:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:'srv.request.x = 6.0;\r\nsrv.request.y = 8.0;\r\nsrv.request.name = "turtle2";\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"73-python-language-implementation",children:"7.3 Python Language Implementation"}),"\n",(0,i.jsx)(n.h3,{id:"731-create-the-client-script",children:"7.3.1 Create the Client Script"}),"\n",(0,i.jsxs)(n.p,{children:["Under ",(0,i.jsx)(n.code,{children:"server/scripts"}),", create the following file:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"a_new_turtle.py\n"})}),"\n",(0,i.jsx)(n.p,{children:"Paste the following content:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python\r\n# -*- coding: utf-8 -*-\r\n\r\nimport rospy\r\nfrom turtlesim.srv import Spawn\r\n\r\ndef turtle_spawn():\r\n    rospy.init_node(\'new_turtle\')     # Initialize ROS node\r\n    rospy.wait_for_service(\'/spawn\') # Wait for spawn service\r\n\r\n    try:\r\n        new_turtle = rospy.ServiceProxy(\'/spawn\', Spawn)\r\n        response = new_turtle(2.0, 2.0, 0.0, "turtle2")\r\n        return response.name\r\n    except rospy.ServiceException as e:\r\n        print("Failed to call service: %s" % e)\r\n\r\nif __name__ == "__main__":\r\n    print("A new turtle named %s." % turtle_spawn())\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"python-program-flow-diagram",children:"Python Program Flow Diagram"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Python Client Flow",src:r(26952).A+"",width:"421",height:"635"})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},26952:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/image-20220225112117967-208eba1a42f9d8a926742f9bbb166990.png"},28453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>l});var t=r(96540);const i={},s=t.createContext(i);function a(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(s.Provider,{value:n},e.children)}},38405:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/image-20220218181244822-7e0cb2c512f6faa4c2d474c389f29015.png"},45837:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/image-20220218180224285-06c185d3ecd74972868354445279b178.png"},64313:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/client-46b2dc64825656543cfc844b49ef9171.jpg"},86603:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/image-20220218180756612-d97b62c50daab803ef5428a3ba468cfd.png"}}]);